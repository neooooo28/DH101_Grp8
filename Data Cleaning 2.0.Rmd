---
title: "Data Cleaning 2.0"
date: "5/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Load libraries
```{r}
# Data Table for faster computing
library(data.table) # CORE
library(dtplyr)     # data.table + dplyr

# This project will use the package `data.table()` which handles reading data much faster than `data.frame()` or `tibble()`. 
# In order to compromise with writing new syntax, I am also using the package `dtplyr()` which is a wrapper for `data.table()` but with the same syntax as `dplyr()`.

# Data Wrangling
library(readr)
library(stringr)    # string manipulation
library(dplyr)
library(tidyr) 
library(magrittr)   # pipes %>% 
library(lubridate)  # handilng dates
library(tidyverse)

# Plotting
library(ggplot2)
library(colorspace)
```

## 2. Cleaning Scripts
```{r}
# Load data
df <- fread("la_arrest.csv")

# Select columns of interest and rename them
df <- df[,.(arrest_date=`Arrest Date`,               # [date] (mm/dd/yyyy)
            time=`Time`,                             # [num] Range: 0000-2400
            area_name=`Area Name`,                   # [fct] 21 unique LA patrol areas
            age=`Age`,                               # [num] Range: 0-97
            sex=`Sex Code`,                          # [fct] Female/Male
            descent=`Descent Code`,                  # [fct] 19 unique descents
            charge_group=`Charge Group Description`, # [fct] 28 unique charge groups
            arrest_type=`Arrest Type Code`,          # [fct] 5 unique arrest types
            rep_dist=`Reporting District`,           # [fct] 1352 unique LAPD reporting districts
            location=`Location`)                     # [num] (Latitude, Longitude)
         ]  

# Split location to latitude and longitude
df <- df %>% 
  cbind(df[,(location)] %>% 
          # Before: (lat, long) - 1 column
          str_replace_all("[()]","") %>% 
          str_split_fixed(", ", n=2) %>% 
          # After: lat | long - 2 columns
          as.data.table() %>% 
          
          # Rename columns
          transmute(latitude = as.numeric(V1), 
                    longitude = as.numeric(V2)) %>% 
          as.data.table()
  ) %>% 
# Remove location data
select(-location)
```

## 3. Changing Codes into Descriptions
```{r}
# Change arrest_date to date object
df <- df[, `:=`(arrest_date = mdy(arrest_date))] %>% 
  as.data.table()

# Change sex code to sex object
df$sex <- str_replace(df$sex, "F", "Female")
df$sex <- str_replace(df$sex, "M", "Male")

# Change descent code to descent object
df %>% mutate(descent = case_when(
  descent == "A" ~ "Other Asian",
  descent == "B" ~ "Black",
  descent == "C" ~ "Chinese",
  descent == "D" ~ "Cambodian",
  descent == "F" ~ "Filipino",
  descent == "G" ~ "Guamanian",
  descent == "H" ~ "Hispanic/Latin/Mexican",
  descent == "I" ~ "American Indian/Alaskan Native",
  descent == "J" ~ "Japanese",
  descent == "K" ~ "Korean",
  descent == "L" ~ "Laotian",
  descent == "O" ~ "Other",
  descent == "P" ~ "Pacific Islander",
  descent == "S" ~ "Samoan",
  descent == "U" ~ "Hawaiian",
  descent == "V" ~ "Vietnamese",
  descent == "W" ~ "White",
  descent == "X" ~ "Unknown",
  descent == "Z" ~ "Asian Indian",
))

# Change arrest type code into arrest type object
df$arrest_type <- str_replace(df$arrest_type, "D", "Dependent")
df$arrest_type <- str_replace(df$arrest_type, "F", "Felony")
df$arrest_type <- str_replace(df$arrest_type, "I", "Infraction")
df$arrest_type <- str_replace(df$arrest_type, "M", "Misdemeanor")
df$arrest_type <- str_replace(df$arrest_type, "O", "Other")
```

## 4. Saving Cleaned Data into a New File
```{r}
# Save cleaned data
fwrite(df, "la_arrest3.csv")
```
